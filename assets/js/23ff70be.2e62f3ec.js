"use strict";(self.webpackChunkwebsite_new=self.webpackChunkwebsite_new||[]).push([[4988],{47712(e,n,s){s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>t,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"developer/docmodel","title":"Document Model Architecture","description":"The document model is the backbone of the application, representing the","source":"@site/docs/developer/docmodel.md","sourceDirName":"developer","slug":"/developer/docmodel","permalink":"/docs/developer/docmodel","draft":false,"unlisted":false,"editUrl":"https://github.com/barebaric/rayforge/tree/main/website/docs/docs/developer/docmodel.md","tags":[],"version":"current","frontMatter":{},"sidebar":"developerSidebar","previous":{"title":"Rayforge Architecture","permalink":"/docs/developer/architecture"},"next":{"title":"Importer Architecture","permalink":"/docs/developer/importer"}}');var i=s(74848),o=s(28453);const c={},t="Document Model Architecture",l={},d=[{value:"Overview",id:"overview",level:2},{value:"Class Inheritance",id:"class-inheritance",level:2},{value:"Object Composition",id:"object-composition",level:2},{value:"DocItem Descriptions",id:"docitem-descriptions",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",mermaid:"mermaid",p:"p",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"document-model-architecture",children:"Document Model Architecture"})}),"\n",(0,i.jsx)(n.p,{children:"The document model is the backbone of the application, representing the\nentire user project as a hierarchical tree of objects. It is designed to\nbe reactive, serializable, and easily traversable."}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(n.p,{children:["The architecture is built on the ",(0,i.jsx)(n.strong,{children:"Composite design pattern"}),". A single\nabstract base class, ",(0,i.jsx)(n.code,{children:"DocItem"}),", defines the common interface for all\nobjects that can exist in the document tree (e.g., layers, workpieces,\ngroups). This allows complex, nested structures to be treated uniformly."]}),"\n",(0,i.jsx)(n.p,{children:"Key principles of the model include:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Tree Structure:"})," The ",(0,i.jsx)(n.code,{children:"Doc"})," object serves as the root of the tree. Each\nitem (except the root) has a single ",(0,i.jsx)(n.code,{children:"parent"})," and can have multiple\n",(0,i.jsx)(n.code,{children:"children"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Reactivity:"})," The model uses a signal/slot system (",(0,i.jsx)(n.code,{children:"blinker"}),'). When an\nitem is changed, it emits a signal. Parent items listen to their\nchildren\'s signals and "bubble them up" the tree. This allows\nhigh-level components like the ',(0,i.jsx)(n.code,{children:"Pipeline"})," to listen for any\nchange in the document by connecting to a single signal on the root\n",(0,i.jsx)(n.code,{children:"Doc"})," object. The system tracks both content changes and transform\nchanges separately for efficient updates."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Transformation Hierarchy:"})," Every ",(0,i.jsx)(n.code,{children:"DocItem"})," has a local transformation\n",(0,i.jsx)(n.code,{children:"Matrix"}),'. An item\'s final position, scale, and rotation in the "world"\n(the main canvas) is the product of its own local matrix and the\nworld matrices of all its ancestors.']}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Data Decoupling:"})," The visual or raw data for a ",(0,i.jsx)(n.code,{children:"WorkPiece"})," is not\nstored directly within it. Instead, the ",(0,i.jsx)(n.code,{children:"WorkPiece"})," holds a UID that\nreferences an ",(0,i.jsx)(n.code,{children:"ImportSource"})," object in a central registry on the ",(0,i.jsx)(n.code,{children:"Doc"}),".\nThis decouples the document structure from the data management,\nmaking the model more lightweight and flexible."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"class-inheritance",children:"Class Inheritance"}),"\n",(0,i.jsxs)(n.p,{children:["This diagram shows the class hierarchy. Every object that is part of the\ndocument's spatial tree inherits from the abstract base class ",(0,i.jsx)(n.code,{children:"DocItem"}),",\ngaining core functionalities like parenting, transformations, and signal\nbubbling."]}),"\n",(0,i.jsx)(n.mermaid,{value:"classDiagram\n    direction TD\n\n    class DocItem {\n        <<abstract>>\n        +uid: str\n        +parent: DocItem\n        +children: List~DocItem~\n        +matrix: Matrix\n        +updated Signal\n        +transform_changed Signal\n        +get_world_transform() Matrix\n    }\n\n    DocItem <|-- Doc\n    DocItem <|-- Layer\n    DocItem <|-- Group\n    DocItem <|-- WorkPiece\n    DocItem <|-- Workflow\n    DocItem <|-- Step\n    DocItem <|-- StockItem\n\n    class Doc\n    class Layer\n    class Group\n    class WorkPiece\n    class Workflow\n    class Step\n    class StockItem"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"DocItem"})}),": The abstract foundation providing the composite pattern\nimplementation."]}),"\n",(0,i.jsxs)(n.li,{children:["All other classes are concrete implementations of ",(0,i.jsx)(n.code,{children:"DocItem"}),", each with a\nspecialized role in the document structure."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"object-composition",children:"Object Composition"}),"\n",(0,i.jsx)(n.p,{children:"This diagram illustrates how instances of the classes are assembled to form\na complete document. It shows the parent-child relationships and\nreferences between objects."}),"\n",(0,i.jsx)(n.mermaid,{value:'graph TD\n        D(Doc)\n        ST(StockItem)\n        L(Layer) -- "owns one" --\x3e WF(Workflow)\n        WF -- "contains" --\x3e S(Step)\n        L -- "contains" --\x3e G(Group)\n        L -- "contains" --\x3e WP(WorkPiece)\n\n    D -- "contains" --\x3e L\n    D -- "contains" --\x3e ST\n\n    G -- "contains (recursive)" --\x3e G\n    G -- "contains" --\x3e WP\n'}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["A ",(0,i.jsx)(n.code,{children:"Doc"})," is the top-level object. It ",(0,i.jsx)(n.strong,{children:"contains"})," one or more ",(0,i.jsx)(n.code,{children:"Layer"}),"s and\n",(0,i.jsx)(n.code,{children:"StockItem"}),"s. It also ",(0,i.jsx)(n.strong,{children:"manages"})," a registry of all ",(0,i.jsx)(n.code,{children:"ImportSource"}),"s in\nthe project."]}),"\n",(0,i.jsxs)(n.li,{children:["Each ",(0,i.jsx)(n.code,{children:"Layer"})," ",(0,i.jsx)(n.strong,{children:"contains"})," the user's content: ",(0,i.jsx)(n.code,{children:"WorkPiece"}),"s and ",(0,i.jsx)(n.code,{children:"Group"}),"s.\nCrucially, a ",(0,i.jsx)(n.code,{children:"Layer"})," also ",(0,i.jsx)(n.strong,{children:"owns one"})," ",(0,i.jsx)(n.code,{children:"Workflow"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["A ",(0,i.jsx)(n.code,{children:"Workflow"})," ",(0,i.jsx)(n.strong,{children:"contains"})," an ordered list of ",(0,i.jsx)(n.code,{children:"Step"}),"s, which define the\nmanufacturing process for that layer."]}),"\n",(0,i.jsxs)(n.li,{children:["A ",(0,i.jsx)(n.code,{children:"Group"})," is a container that can hold ",(0,i.jsx)(n.code,{children:"WorkPiece"}),"s and other ",(0,i.jsx)(n.code,{children:"Group"}),"s,\nallowing for nested transformations."]}),"\n",(0,i.jsxs)(n.li,{children:["A ",(0,i.jsx)(n.code,{children:"WorkPiece"})," is a fundamental design element. It does not store its\nraw data directly. Instead, it ",(0,i.jsx)(n.strong,{children:"references"})," an ",(0,i.jsx)(n.code,{children:"ImportSource"})," via a\nUID. It also ",(0,i.jsx)(n.strong,{children:"has"})," its own ",(0,i.jsx)(n.code,{children:"Geometry"})," (vector data) and can have a\nlist of ",(0,i.jsx)(n.code,{children:"Tab"}),"s."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"docitem-descriptions",children:"DocItem Descriptions"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:[(0,i.jsx)(n.code,{children:"DocItem"})," (Abstract)"]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Role:"})," The abstract base for all tree nodes."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Key Properties:"})," ",(0,i.jsx)(n.code,{children:"uid"}),", ",(0,i.jsx)(n.code,{children:"parent"}),", ",(0,i.jsx)(n.code,{children:"children"}),", ",(0,i.jsx)(n.code,{children:"matrix"}),", ",(0,i.jsx)(n.code,{children:"updated"}),"\nsignal, ",(0,i.jsx)(n.code,{children:"transform_changed"})," signal. Provides the core composite\npattern logic."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"Doc"})})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Role:"})," The root of the document tree."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Key Properties:"})," ",(0,i.jsx)(n.code,{children:"children"})," (Layers, StockItems), ",(0,i.jsx)(n.code,{children:"import_sources"}),"\n(a dictionary mapping UIDs to ",(0,i.jsx)(n.code,{children:"ImportSource"})," objects), ",(0,i.jsx)(n.code,{children:"active_layer"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"Layer"})})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Role:"})," The primary organizational unit for content. A layer\nassociates a group of workpieces with a single manufacturing\nworkflow."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Key Properties:"})," ",(0,i.jsx)(n.code,{children:"children"})," (WorkPieces, Groups, one Workflow),\n",(0,i.jsx)(n.code,{children:"visible"}),", ",(0,i.jsx)(n.code,{children:"stock_item_uid"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"Group"})})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Role:"})," A container for other ",(0,i.jsx)(n.code,{children:"DocItem"}),"s (",(0,i.jsx)(n.code,{children:"WorkPiece"}),", ",(0,i.jsx)(n.code,{children:"Group"}),").\nAllows a collection of items to be transformed as a single unit."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"WorkPiece"})})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Role:"})," Represents a single, tangible design element on the canvas\n(e.g., an imported SVG)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Key Properties:"})," ",(0,i.jsx)(n.code,{children:"vectors"})," (a ",(0,i.jsx)(n.code,{children:"Geometry"})," object),\n",(0,i.jsx)(n.code,{children:"import_source_uid"}),",\n",(0,i.jsx)(n.code,{children:"tabs"}),", ",(0,i.jsx)(n.code,{children:"tabs_enabled"}),". Its ",(0,i.jsx)(n.code,{children:"vectors"})," are normalized to a 1x1 box,\nwith all scaling and positioning handled by its transformation\n",(0,i.jsx)(n.code,{children:"matrix"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"Workflow"})})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Role:"})," An ordered sequence of processing instructions. Owned by a\n",(0,i.jsx)(n.code,{children:"Layer"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Key Properties:"})," ",(0,i.jsx)(n.code,{children:"children"})," (an ordered list of ",(0,i.jsx)(n.code,{children:"Step"}),"s)."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"Step"})})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Role:"})," A single processing instruction within a ",(0,i.jsx)(n.code,{children:"Workflow"}),' (e.g.,\n"Contour Cut" or "Raster Engrave"). It is a configuration object\nholding dictionaries that define the producer, modifiers, and\ntransformers to be used.']}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"StockItem"})})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Role:"})," Represents a piece of physical material in the document,\ndefined by its own vector ",(0,i.jsx)(n.code,{children:"geometry"}),". ",(0,i.jsx)(n.code,{children:"Layer"}),"s can be assigned to a\nspecific stock item."]}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},28453(e,n,s){s.d(n,{R:()=>c,x:()=>t});var r=s(96540);const i={},o=r.createContext(i);function c(e){const n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);